<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ccf-ui documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">ccf-ui documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li >DataSourceService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Backend data queries.</p>

            </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#dataSource" >dataSource</a>
                            </li>
                            <li>
                                <a href="#dbOptions" >dbOptions</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#subscriptions" >subscriptions</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#connectDataSource" >connectDataSource</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#createDataSource" >createDataSource</a>
                            </li>
                            <li>
                                <a href="#getAggregateResults" >getAggregateResults</a>
                            </li>
                            <li>
                                <a href="#getOntologyTermOccurences" >getOntologyTermOccurences</a>
                            </li>
                            <li>
                                <a href="#getOntologyTreeModel" >getOntologyTreeModel</a>
                            </li>
                            <li>
                                <a href="#getReferenceOrgans" >getReferenceOrgans</a>
                            </li>
                            <li>
                                <a href="#getScene" >getScene</a>
                            </li>
                            <li>
                                <a href="#getTissueBlockResults" >getTissueBlockResults</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getWebWorkerDataSource" >getWebWorkerDataSource</a>
                            </li>
                            <li>
                                <a href="#ngOnDestroy" >ngOnDestroy</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(locator: <a href="https://angular.io/api/common/LocationStrategy" target="_blank">LocationStrategy</a>, globalConfig: <a href="../injectables/GlobalConfigState.html" target="_self">GlobalConfigState&lt;CCFDatabaseOptions&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:42</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Creates an instance of data source service.</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>locator</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://angular.io/api/common/LocationStrategy" target="_blank" >LocationStrategy</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>globalConfig</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/GlobalConfigState.html" target="_self" >GlobalConfigState&lt;CCFDatabaseOptions&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="connectDataSource"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>connectDataSource</b></span>
                        <a href="#connectDataSource"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>connectDataSource(source: <a href="../undefineds/DataSource.html" target="_self">DataSource</a>, config: <a href="../interfaces/CCFDatabaseOptions.html" target="_self">CCFDatabaseOptions</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="176"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:176</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>source</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#DataSource" target="_self" >DataSource</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>config</td>
                                    <td>
                                                <code><a href="../interfaces/CCFDatabaseOptions.html" target="_self" >CCFDatabaseOptions</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/typealiases.html#DataSource" target="_self" >Promise&lt;DataSource&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createDataSource"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>createDataSource</b></span>
                        <a href="#createDataSource"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createDataSource()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="158"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:158</a></div>
                </td>
            </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAggregateResults"></a>
                    <span class="name">
                        <span ><b>getAggregateResults</b></span>
                        <a href="#getAggregateResults"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getAggregateResults(filter?: <a href="../interfaces/Filter.html" target="_self">Filter</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="101"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:101</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Queries for aggregate values.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../interfaces/Filter.html" target="_self" >Filter</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>Currently applied filter.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/AggregateResult.html" target="_self" >Observable&lt;AggregateResult[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting the results.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getOntologyTermOccurences"></a>
                    <span class="name">
                        <span ><b>getOntologyTermOccurences</b></span>
                        <a href="#getOntologyTermOccurences"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getOntologyTermOccurences(filter?: <a href="../interfaces/Filter.html" target="_self">Filter</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="114"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:114</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Queries for ontology term counts.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../interfaces/Filter.html" target="_self" >Filter</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>Currently applied filter.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Observable&lt;Record&lt;string, number&gt;&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting the results.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getOntologyTreeModel"></a>
                    <span class="name">
                        <span ><b>getOntologyTreeModel</b></span>
                        <a href="#getOntologyTreeModel"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getOntologyTreeModel()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="126"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:126</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Get the ontology tree model.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/OntologyTreeModel.html" target="_self" >Observable&lt;OntologyTreeModel&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting the results.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getReferenceOrgans"></a>
                    <span class="name">
                        <span ><b>getReferenceOrgans</b></span>
                        <a href="#getReferenceOrgans"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getReferenceOrgans()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="138"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:138</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Get the reference organs.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/SpatialEntity.html" target="_self" >Observable&lt;SpatialEntity[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting the results.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getScene"></a>
                    <span class="name">
                        <span ><b>getScene</b></span>
                        <a href="#getScene"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getScene(filter?: <a href="../interfaces/Filter.html" target="_self">Filter</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="151"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:151</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Queries for scene nodes to display.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../interfaces/Filter.html" target="_self" >Filter</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>Currently applied filter.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Observable&lt;SpatialSceneNode[]&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting the results.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getTissueBlockResults"></a>
                    <span class="name">
                        <span ><b>getTissueBlockResults</b></span>
                        <a href="#getTissueBlockResults"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getTissueBlockResults(filter?: <a href="../interfaces/Filter.html" target="_self">Filter</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="88"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:88</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Queries for tissue block values.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../interfaces/Filter.html" target="_self" >Filter</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                    <td>
                                        <p>Currently applied filter.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/TissueBlockResult.html" target="_self" >Observable&lt;TissueBlockResult[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        <p>An observable emitting the results.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getWebWorkerDataSource"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>getWebWorkerDataSource</b></span>
                        <a href="#getWebWorkerDataSource"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getWebWorkerDataSource(directImport)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="185"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:185</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>directImport</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>literal type</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="ngOnDestroy"></a>
                    <span class="name">
                        <span ><b>ngOnDestroy</b></span>
                        <a href="#ngOnDestroy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>ngOnDestroy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="78"
                            class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:78</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="dataSource"></a>
                    <span class="name">
                        <span ><b>dataSource</b></span>
                        <a href="#dataSource"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../miscellaneous/typealiases.html#DataSource" target="_self" >Observable&lt;DataSource&gt;</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:38</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>The underlying database.</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="dbOptions"></a>
                    <span class="name">
                        <span ><b>dbOptions</b></span>
                        <a href="#dbOptions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../interfaces/CCFDatabaseOptions.html" target="_self" >CCFDatabaseOptions</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="40" class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:40</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Database initialization options.</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="subscriptions"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>subscriptions</b></span>
                        <a href="#subscriptions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Subscription()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">projects/ccf-eui/src/app/core/services/data-source/data-source.service.ts:42</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { GlobalConfigState } from &#x27;ccf-shared&#x27;;
import { LocationStrategy } from &#x27;@angular/common&#x27;;
import { Injectable, OnDestroy } from &#x27;@angular/core&#x27;;
import {
  AggregateResult,
  CCFDatabase,
  CCFDatabaseOptions,
  Filter,
  OntologyTreeModel,
  SpatialEntity,
  SpatialSceneNode,
  TissueBlockResult,
} from &#x27;ccf-database&#x27;;
import { releaseProxy, Remote, wrap } from &#x27;comlink&#x27;;
import { Observable, Subscription, using, Unsubscribable } from &#x27;rxjs&#x27;;
import { take, distinctUntilChanged, shareReplay, switchMap, filter } from &#x27;rxjs/operators&#x27;;

import { environment } from &#x27;../../../../environments/environment&#x27;;


type DataSource &#x3D; Remote&lt;CCFDatabase&gt; | CCFDatabase;


function compareConfig(previous: CCFDatabaseOptions, current: CCFDatabaseOptions): boolean {
  return previous &#x3D;&#x3D;&#x3D; current;
}


/**
 * Backend data queries.
 */
@Injectable({
  providedIn: &#x27;root&#x27;
})
export class DataSourceService implements OnDestroy {
  /** The underlying database. */
  dataSource: Observable&lt;DataSource&gt;;
  /** Database initialization options. */
  dbOptions: CCFDatabaseOptions;

  private readonly subscriptions &#x3D; new Subscription();

  /**
   * Creates an instance of data source service.
   */
  constructor(
    private readonly locator: LocationStrategy,
    private readonly globalConfig: GlobalConfigState&lt;CCFDatabaseOptions&gt;
  ) {
    this.dataSource &#x3D; globalConfig.config$.pipe(
      filter(config &#x3D;&gt; Object.keys(config).length &gt; 0),
      distinctUntilChanged(compareConfig),
      switchMap(config &#x3D;&gt; using(
        () &#x3D;&gt; this.createDataSource(),
        (resource) &#x3D;&gt; this.connectDataSource((resource as unknown as { source: DataSource}).source, config)
      )),
      shareReplay(1)
    );

    this.subscriptions.add(this.dataSource.subscribe());

    // this.dbOptions &#x3D; environment.dbOptions as CCFDatabaseOptions;

    // if (typeof globalThis &#x3D;&#x3D;&#x3D; &#x27;object&#x27;) {
    //   // If a global dbOptions object is set, use this for connecting to the db
    //   if (globalThis.dbOptions) {
    //     this.dbOptions &#x3D; { ...this.dbOptions, ...globalThis.dbOptions } as CCFDatabaseOptions;
    //   }

    //   // In development, make the db globally accessible
    //   if (!environment.production) {
    //     ((globalThis as unknown) as { db: Remote&lt;CCFDatabase&gt; | CCFDatabase }).db &#x3D; this.dataSource;
    //   }
    // }
  }

  ngOnDestroy(): void {
    this.subscriptions.unsubscribe();
  }

  /**
   * Queries for tissue block values.
   *
   * @param [filter] Currently applied filter.
   * @returns An observable emitting the results.
   */
   getTissueBlockResults(filter?: Filter): Observable&lt;TissueBlockResult[]&gt; {
     return this.dataSource.pipe(
       switchMap(db &#x3D;&gt; db.getTissueBlockResults(filter)),
       take(1)
     );
  }

  /**
   * Queries for aggregate values.
   *
   * @param [filter] Currently applied filter.
   * @returns An observable emitting the results.
   */
  getAggregateResults(filter?: Filter): Observable&lt;AggregateResult[]&gt; {
    return this.dataSource.pipe(
      switchMap(db &#x3D;&gt; db.getAggregateResults(filter)),
      take(1)
    );
  }

  /**
   * Queries for ontology term counts.
   *
   * @param [filter] Currently applied filter.
   * @returns An observable emitting the results.
   */
  getOntologyTermOccurences(filter?: Filter): Observable&lt;Record&lt;string, number&gt;&gt; {
    return this.dataSource.pipe(
      switchMap(db &#x3D;&gt; db.getOntologyTermOccurences(filter)),
      take(1)
    );
  }

  /**
   * Get the ontology tree model.
   *
   * @returns An observable emitting the results.
   */
  getOntologyTreeModel(): Observable&lt;OntologyTreeModel&gt; {
    return this.dataSource.pipe(
      switchMap(db &#x3D;&gt; db.getOntologyTreeModel()),
      take(1)
    );
  }

  /**
   * Get the reference organs.
   *
   * @returns An observable emitting the results.
   */
   getReferenceOrgans(): Observable&lt;SpatialEntity[]&gt; {
    return this.dataSource.pipe(
      switchMap(db &#x3D;&gt; db.getReferenceOrgans()),
      take(1)
    );
  }

  /**
   * Queries for scene nodes to display.
   *
   * @param [filter] Currently applied filter.
   * @returns An observable emitting the results.
   */
   getScene(filter?: Filter): Observable&lt;SpatialSceneNode[]&gt; {
    return this.dataSource.pipe(
      switchMap(db &#x3D;&gt; db.getScene(filter)),
      take(1)
    );
  }

  private createDataSource(): { source: DataSource } &amp; Unsubscribable {
    let source: DataSource;
    let unsubscribe: () &#x3D;&gt; void &#x3D; () &#x3D;&gt; undefined;

    if (typeof Worker !&#x3D;&#x3D; &#x27;undefined&#x27; &amp;&amp; !environment.disableDbWorker) {
      let worker: Worker;
      ({ source, worker } &#x3D; this.getWebWorkerDataSource(true));
      unsubscribe &#x3D; async () &#x3D;&gt; {
        await source[releaseProxy]();
        worker.terminate();
      };
    } else {
      source &#x3D; new CCFDatabase();
    }

    return { source, unsubscribe };
  }

  private async connectDataSource(source: DataSource, config: CCFDatabaseOptions): Promise&lt;DataSource&gt; {
    if (environment.disableDbWorker) {
      await new Promise(r &#x3D;&gt; setTimeout(r, 100));
    }

    await source.connect(config);
    return source;
  }

  private getWebWorkerDataSource(directImport &#x3D; false): { source: Remote&lt;CCFDatabase&gt;; worker: Worker } {
    let worker: Worker;
    if (directImport) {
      worker &#x3D; new Worker(new URL(&#x27;./data-source.worker&#x27;, import.meta.url), { type: &#x27;module&#x27; });
    } else {
      const workerUrl &#x3D; this.locator.prepareExternalUrl(&#x27;0-es2015.worker.js&#x27;);
      const workerBlob &#x3D; new Blob([&#x60;importScripts(&#x27;${workerUrl}&#x27;)&#x60;,], {type: &#x27;application/javascript&#x27;});
      worker &#x3D; new Worker(URL.createObjectURL(workerBlob), { type: &#x27;module&#x27; });
    }
    return { source: wrap(worker), worker };
  }
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'DataSourceService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       
       <script type="module" src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
